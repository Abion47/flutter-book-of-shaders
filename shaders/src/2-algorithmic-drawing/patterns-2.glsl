// https://thebookofshaders.com/09/

// Author @patriciogv ( patriciogonzalezvivo.com ) - 2015

#include <../fl-utility.glsl>

#ifdef GL_ES
  precision mediump float;
#endif

// Copyright (c) Patricio Gonzalez Vivo, 2015 - http://patriciogonzalezvivo.com/
// I am the sole copyright owner of this Work.
//
// You cannot host, display, distribute or share this Work in any form,
// including physical and digital. You cannot use this Work in any
// commercial or non-commercial product, website or project. You cannot
// sell this Work and you cannot mint an NFTs of it.
// I share this Work for educational purposes, and you can link to it,
// through an URL, proper attribution and unmodified screenshot, as part
// of your educational material. If these conditions are too restrictive
// please contact me and we'll definitely work it out.

// Constants
#define PI 3.14159265358979323846

// Input
uniform vec2 u_resolution;

// Output
out vec4 o_fragColor;

vec2 rotate2D(vec2 _st, float _angle) {
  _st -= 0.5;
  _st =  mat2(cos(_angle), -sin(_angle),
              sin(_angle),  cos(_angle)) * _st;
  _st += 0.5;
  return _st;
}

vec2 tile(vec2 _st, float _zoom) {
  _st *= _zoom;
  return fract(_st);
}

float box(vec2 _st, vec2 _size, float _smoothEdges) {
  _size = vec2(0.5) - _size * 0.5;
  vec2 aa = vec2(_smoothEdges * 0.5);
  vec2 uv = smoothstep(_size, _size + aa, _st);
  uv *= smoothstep(_size, _size + aa, vec2(1.0) - _st);
  return uv.x * uv.y;
}

void main() {
  vec2 st = fl_FragCoord(u_resolution) / u_resolution;
  vec3 color = vec3(0.0);

  // Divide the space in 4
  st = tile(st, 4.0);

  // Use a matrix to rotate the space 45 degrees
  st = rotate2D(st, PI * 0.25);

  // Draw a square
  color = vec3(box(st, vec2(0.7), 0.01));
  // color = vec3(st, 0.0);

  o_fragColor = vec4(color, 1.0);
}